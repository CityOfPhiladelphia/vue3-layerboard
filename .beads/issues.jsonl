{"id":"vue3-layerboard-2a7","title":"Fix layers showing Error when toggled","description":"Some layers show 'Error' when toggled on, likely due to CORS or server unavailability. Consider adding proxy for CORS-blocked services.","notes":"## Research Findings (2026-01-29)\n\n**Error flow:** MapPanel.vue → fetchFeaturesInBounds() fails → emits layer-error → Layerboard.vue stores in layerErrors → UI shows \"Error\" in red\n\n**Error sources:**\n- HTTP failures (403, 500, 429, etc.)\n- Network timeouts\n- DNS resolution failures\n- CORS issues (separate from csi bug)\n\n**Weak patterns identified:**\n- No retry logic after failures\n- No timeout handling for slow servers\n- Errors persist when layer is toggled off (stale errors not cleared)\n- Generic error messages don't distinguish failure types\n- No fallback/recovery mechanisms\n\n**Recommended fixes:**\n1. Add retry logic with exponential backoff for transient failures (503, 429, timeouts)\n2. Add timeout parameter to fetch calls\n3. Clear errors when layer is toggled off\n4. Improve error messages to distinguish CORS vs HTTP vs timeout\n5. Add optional \"retry\" button for failed layers\n6. Consider caching successfully loaded data per session\n\n**Relationship to csi:** Some errors may be CORS-related (tracked separately in vue3-layerboard-csi). This bug focuses on general error handling improvements.\n## Closed (2026-01-29)\n\n**Speculative issue.** This bead was created assuming CORS console errors would cause visible \"Error\" states in the UI. After investigation:\n\n1. The CORS errors are pre-existing (same in production legacy app)\n2. They don't affect functionality - just console noise\n3. No actual \"Error\" display has been observed in the layer UI\n\nThe error handling infrastructure exists and works correctly. If actual layer errors are observed in the future, a new bead can be created with specific reproduction steps.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:23:54.6277867-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-29T14:00:44.3575441-05:00","closed_at":"2026-01-29T14:00:44.3575441-05:00"}
{"id":"vue3-layerboard-3pb","title":"Write vue3-layerboard documentation","description":"Write README and docs: explain what vue3-layerboard is, installation instructions, basic usage example (flat mode), topics mode example, link to example apps, API reference.","status":"open","priority":3,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:24:46.292479-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T10:24:46.292479-05:00"}
{"id":"vue3-layerboard-4yx","title":"Publish vue3-layerboard to npm","description":"Publish framework as @phila/vue3-layerboard package. Start with beta release, test in separate project, then publish stable when ready.","status":"open","priority":3,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:25:02.4608449-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T10:25:02.4608449-05:00"}
{"id":"vue3-layerboard-5om","title":"Pictometry should move position when the address search bar is used","description":"When a user searches for an address using the address search bar, the Pictometry imagery viewer should update its position to match the searched location. Currently the map moves but Pictometry stays at its previous position.\n\nAlso: if Pictometry is closed, then the user searches an address, then reopens Pictometry, it should open at the newly searched location rather than the old position.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-09T10:15:34.7176815-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T11:15:34.3105548-05:00","closed_at":"2026-02-10T11:15:34.3105548-05:00","close_reason":"fixed"}
{"id":"vue3-layerboard-6mr","title":"Replace title-attribute error tooltips with accessible text in LayerPanel, LayerCheckboxSet, LayerRadioButtonSet","description":"Error indicators on layers use the title attribute for tooltips (e.g., \"Layer failed to load\"). The title attribute is not reliably announced by screen readers — many ignore it entirely or only read it in specific browse modes.\n\n**Files to change:**\n- src/components/LayerPanel.vue\n- src/components/LayerCheckboxSet.vue\n- src/components/LayerRadioButtonSet.vue\n\n**What to do:**\nFind error indicator elements that rely on title=\"...\" for conveying error state. Replace or supplement with one of:\n1. Visible error text (preferred — e.g., a small \"(error)\" or warning icon with sr-only text)\n2. aria-label on the error element\n3. An aria-describedby pointing to visually-hidden text\n\nThe key requirement is that the error state must be programmatically discoverable by assistive technology without relying on title.\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T11:05:06.9269666-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T11:05:50.4188632-05:00"}
{"id":"vue3-layerboard-7sp","title":"Add aria-hidden to decorative legend color swatches in LayerPanel, LayerCheckboxSet, LayerRadioButtonSet","description":"Legend color swatches (colored div elements next to layer names) are decorative — the layer name already provides the accessible text. Without aria-hidden=\"true\", screen readers announce these as empty or meaningless elements.\n\n**Files to change:**\n- src/components/LayerPanel.vue\n- src/components/LayerCheckboxSet.vue\n- src/components/LayerRadioButtonSet.vue\n\n**What to do:**\nFind elements with class .layer-legend-swatch (or similar colored div/span elements that display the legend color). Add aria-hidden=\"true\" to each one. These are purely visual indicators whose meaning is conveyed by the adjacent layer name text.\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T11:04:53.9645388-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T11:05:37.8112474-05:00"}
{"id":"vue3-layerboard-86h","title":"Fix mobile layout issues","description":"Both apps have mobile layout problems: 1) Headers get messed up by the large logo. 2) Footer completely disappears on phone and map runs off bottom. Solution: Footer should disappear and its items should go into a hamburger menu in the header where the large logo currently is in non-mobile.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:24:28.7286529-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T17:07:06.2028474-05:00","closed_at":"2026-01-28T17:07:06.2028474-05:00","close_reason":"fixed"}
{"id":"vue3-layerboard-87p","title":"a11y: Add focus-visible styles to all interactive elements","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nAll interactive elements in layerboard need visible focus indicators:\n- Use :focus-visible (not :focus) so mouse users don't see focus rings\n- Ensure sufficient contrast on focus outlines (WCAG requires 3:1 against adjacent colors)\n- Covers: layer checkboxes, group headers, any buttons, close/toggle controls\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:44:44.4068915-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:46:01.7002132-05:00"}
{"id":"vue3-layerboard-8mv","title":"a11y: Focus management when panel opens/closes","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nWhen the layerboard panel opens or closes, focus should be managed so keyboard/screen reader users aren't lost:\n- When panel opens: move focus to the panel or its first interactive element\n- When panel closes: return focus to the element that triggered the open (e.g. the toggle button)\n- Avoid focus trapping — users should be able to tab out of the panel\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:44:35.269104-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:52.4421338-05:00"}
{"id":"vue3-layerboard-9xs","title":"a11y: Add skip-to-main-content link","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nWhen the app loads, if a keyboard user hits Tab, the first focusable element should be a \"Skip to main content\" link that jumps past the header/controls to the main content area.\n\nReference implementation: vue3-atlas App.vue — an \u003ca href=\"#main\" class=\"skip-to-main-content-link\"\u003e positioned off-screen (left: -9999px, opacity: 0) that becomes visible on :focus (left: 0, top: 0, opacity: 1). Dark blue background (#0f4d90), white underlined text, z-index 999. Target is \u003cmain id=\"main\"\u003e.\n\nThis needs to be implemented in the consuming app (openmaps), not in layerboard itself, since layerboard is a panel component — but layerboard's panel should have a proper landmark role so the skip link can target content after it.\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:43:46.7614951-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:06.3676635-05:00"}
{"id":"vue3-layerboard-ccs","title":"Add keyboard navigation to popup","description":"Arrow keys to cycle through features when popup is open (Left/Up = previous, Right/Down = next). Escape to close popup. Only active when popup is visible. Don't interfere with text input fields.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:23:21.2286377-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T16:45:12.7877205-05:00","closed_at":"2026-01-28T16:45:12.7877205-05:00","close_reason":"fixed"}
{"id":"vue3-layerboard-cmm","title":"a11y: Add keyboard support to layer group headers","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nLayer group headers (the clickable elements that expand/collapse groups) need to be operable via keyboard:\n- Focusable (tabindex or use a \u003cbutton\u003e)\n- Enter and Space should toggle expand/collapse\n- Arrow keys for navigating between groups (optional but nice)\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:44:15.146632-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:34.2204853-05:00"}
{"id":"vue3-layerboard-csi","title":"Fix CORS errors for plowphl-services.phila.gov","description":"CORS errors appear in devtools for plowphl-services.phila.gov. The app seems to work but errors are present. Either server needs CORS headers enabled, or add proxy support in the framework.","notes":"## Research Findings (2026-01-29)\n\n**URL Clarification:** Could not find \"plowphl-services.phila.gov\" in codebase. Actual PlowPHL services are at `streetsgis.phila.gov/arcgis/rest/services/PlowPHL/*`\n\n**Services in use:**\n- Tiled layers: `https://streetsgis.phila.gov/arcgis/rest/services/PlowPHL/{service}/MapServer`\n- Data APIs: `stsweb.phila.gov`, `admin.phila.gov`\n\n**Impact:** CORS errors appear to be warnings only - raster tiles load via different browser rules than API calls. App functions despite console errors.\n\n**Root cause:** Philadelphia city servers don't have CORS headers configured.\n\n**Recommended solutions:**\n1. **Dev (short-term):** Add Vite proxy config to route API calls through local server\n2. **Prod (long-term):** Contact city IT to enable CORS headers, or implement backend proxy\n\n**Current framework limitation:** No built-in CORS handling or proxy support.\n## Closed (2026-01-29)\n\n**Not a bug.** The CORS errors for plowphl-services.phila.gov also appear in the production legacy StreetSmartPHL app (streetsmartphl.phila.gov). This is pre-existing server behavior, not something we introduced.\n\nThe functional PlowPHL layers are served from streetsgis.phila.gov (which has CORS configured). The WebMap references both servers, and the plowphl-services.phila.gov requests fail but don't affect functionality.\n\nClosing as \"works as expected\" - matches production behavior.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:23:38.0294884-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-29T13:53:29.6816094-05:00","closed_at":"2026-01-29T13:53:29.6816094-05:00"}
{"id":"vue3-layerboard-j3v","title":"Cyclomedia should move position when the address search bar is used","description":"When a user searches for an address using the address search bar, the Cyclomedia street-level viewer should update its position to match the searched location. Currently the map moves but Cyclomedia stays at its previous position.\n\nAlso: if Cyclomedia is closed, then the user searches an address, then reopens Cyclomedia, it should open at the newly searched location rather than the old position.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-09T10:07:11.8995178-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T11:15:21.7148491-05:00","closed_at":"2026-02-10T11:15:21.7148491-05:00","close_reason":"fixed"}
{"id":"vue3-layerboard-js3","title":"a11y: Add aria-expanded to layer group expand/collapse","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nLayer groups in the layerboard panel can be expanded/collapsed. The clickable header element needs aria-expanded=\"true\"/\"false\" to communicate state to screen readers. Should toggle when the group is opened/closed.\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:43:56.2155-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:15.8713492-05:00"}
{"id":"vue3-layerboard-ks5","title":"Fix StreetSmartPHL layer panel overflow-y scroll","description":"The layer panel in StreetSmartPHL does not scroll correctly when content overflows vertically.","status":"closed","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:24:10.5283641-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T16:45:12.4178904-05:00","closed_at":"2026-01-28T16:45:12.4178904-05:00","close_reason":"fixed"}
{"id":"vue3-layerboard-ox3","title":"Migrate OpenMaps to use framework package","description":"Create branch in original openmaps repo, install @phila/vue3-layerboard, replace framework code with package imports, keep only app-specific config, test and deploy.","status":"open","priority":3,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:25:19.1237215-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T10:25:19.1237215-05:00"}
{"id":"vue3-layerboard-qlg","title":"a11y: Add proper labels and aria-checked to layer checkboxes","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nLayer checkboxes in the panel need:\n- Proper \u003clabel\u003e elements associated with each checkbox (or aria-label)\n- aria-checked reflecting toggle state\n- Labels should include the layer name so screen readers announce what's being toggled\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:44:05.6379166-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:25.0947955-05:00"}
{"id":"vue3-layerboard-rfm","title":"Migrate StreetSmartPHL to use framework package","description":"Create vue3-streetsmartphl repo, install @phila/vue3-layerboard, create topic Vue components, migrate from old Vue 2 layerboard patterns, test and deploy.","status":"open","priority":3,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-01-28T10:25:36.3872897-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-28T10:25:36.3872897-05:00"}
{"id":"vue3-layerboard-tpi","title":"a11y: Add landmark role and aria-label to panel","description":"WCAG 2.1 AA compliance (deadline April 24, 2026).\n\nThe layerboard panel needs:\n- A landmark role (e.g. role=\"region\" or \u003cnav\u003e) so screen readers can identify and skip to/past it\n- An aria-label describing the panel (e.g. \"Map layer controls\")\n- This helps keyboard users navigate the page structure and supports the skip-to-main-content link pattern\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T08:44:24.5980658-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T08:45:43.4342715-05:00"}
{"id":"vue3-layerboard-ups","title":"Add for/id pairing between opacity label and range input in LayerPanel, LayerCheckboxSet, LayerRadioButtonSet","description":"The opacity slider has a visual \u003clabel class=\"opacity-label\"\u003e element as a sibling of the \u003cinput type=\"range\"\u003e, but they are not programmatically associated via for/id. Screen readers already get the accessible name from aria-label on the input, so this is low priority, but proper label association is better practice and gives users a larger click target.\n\n**Files to change:**\n- src/components/LayerPanel.vue\n- src/components/LayerCheckboxSet.vue\n- src/components/LayerRadioButtonSet.vue\n\n**What to do:**\n1. Add a unique id to each opacity \u003cinput type=\"range\"\u003e (e.g., id=\"opacity-slider-{layerId}\" or similar, using a dynamic value to avoid collisions when multiple sliders exist)\n2. Add a matching for=\"opacity-slider-{layerId}\" to the \u003clabel class=\"opacity-label\"\u003e element\n3. Keep the existing aria-label on the input — the for/id pairing supplements it, doesn't replace it\n","status":"open","priority":2,"issue_type":"task","owner":"rothwell.andy@gmail.com","created_at":"2026-02-10T11:05:18.0840731-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-02-10T11:06:02.7681228-05:00"}
{"id":"vue3-layerboard-vee","title":"PlowPHL layers get fuzzy when zooming in - missing scale-based layer switching","description":"## Problem\nIn the streetsmartphl example, PlowPHL layers (Treated Street Status, etc.) look correct when zoomed out, but when zooming in the layer becomes fuzzy/pixelated. The graphics don't re-render at higher resolution - they just scale up the low-zoom tiles.\n\n## Root Cause\nThe vue3-layerboard implementation only uses tiled MapServer endpoints at all zoom levels. The legacy StreetSmartPHL app has a two-layer approach that switches between:\n- **zoomOut** (`tiled: true`): MapServer `/tile/` endpoint - fast, pre-cached tiles\n- **zoomIn** (`tiled: false`): Dynamic WebMap layers fetched from ArcGIS with full resolution\n\nThe legacy app gets `minScale`/`maxScale` from the ArcGIS REST API for each layer, watches the current map scale, and automatically swaps between the tiled and dynamic versions based on zoom level.\n\n## Affected Layers\nAll PlowPHL tiled layers in `examples/streetsmartphl/src/App.vue` (lines 193-224):\n- plowTreatedStreetsStatus\n- plowNotTreatedStreets  \n- plowConditional\n- plowHighways\n\nURLs: `https://streetsgis.phila.gov/arcgis/rest/services/PlowPHL/{service}/MapServer`\n\n## Fix Required\nImplement the same two-layer approach with scale-based switching that the legacy app has:\n\n1. For each PlowPHL layer, define two versions:\n   - zoomOut: current tiled MapServer approach\n   - zoomIn: dynamic WebMap layer (need to find/add these to a WebMap or use /export/ endpoint)\n\n2. Fetch layer definitions with minScale/maxScale from ArcGIS REST API\n\n3. Watch map scale changes and toggle between the two layer versions based on the scale thresholds\n\n## Reference\nLegacy implementation in StreetSmartPHL:\n- `src/topics/plow.js` - topic-tiled-layers config with zoomIn/zoomOut pairs\n- `src/components/TopicTiledLayers.vue` - handles the switching logic\n- `src/components/Checkbox.vue` - shouldBeDisabled() checks minScale/maxScale\n\n## Testing Notes\nRequires an active snow event to test. May need to mock the storms API response to simulate a deployment.","notes":"**Mock in place for testing:** Line 530 in `examples/streetsmartphl/src/App.vue` has been changed to default to 'Full Deployment' when no storm data exists. This allows testing PlowPHL layers without an active snow event. Revert this line before committing any fix:\n```typescript\n// Current (mocked):\nreturn stormsData?.Deployment || 'Full Deployment'  // MOCK: remove before committing\n\n// Original:\nreturn stormsData?.Deployment || ''\n```\n## Implementation Complete (2026-01-29)\n\nScale-based layer switching implemented on branch `wip/plowphl-zoom-fix`:\n- Layers with `scaleBasedRendering: true` fetch MapServer metadata for scale thresholds\n- Zoomed out: uses /tile/ endpoint (fast, cached)\n- Zoomed in: uses /export/ endpoint (dynamic, sharp)\n\n**Testing limitation:** Can't fully verify without active snow event. Export requests return 200 OK but images are empty (no current data on server). Mock removed - awaiting next snow event to verify.","status":"open","priority":2,"issue_type":"bug","owner":"rothwell.andy@gmail.com","created_at":"2026-01-29T12:57:20.0734585-05:00","created_by":"rothwell.andy@gmail.com","updated_at":"2026-01-29T14:02:39.6851907-05:00"}
